#!/usr/bin/env node
/* vim: set filetype=javascript : */

var _ = require("lodash");
var fs = require("fs");
var shell = require("shelljs");

var buildScriptDir = "./bin/build-scripts/";
var out = process.stdout;

var getBuildScripts = function() {
	return fs.readdirSync(buildScriptDir);
}

var runBuildScript = function(scriptName)
{
	out.write("Building \""+scriptName+"\"... ");

	var scriptPath = buildScriptDir+scriptName;
	var result = shell.exec("node "+scriptPath).code;

	if(result == 0)
		out.write("Complete!\n");
	else
	{
		out.write("failed.\n");
		throw new Error("`"+scriptName+"` build failed and returned: "+result);
	}
}

if(!module.parent) {
	var buildScripts = getBuildScripts();
	_.each(buildScripts, function(scriptName)
	{
		try
		{
			runBuildScript(scriptName);
		}
		catch (e)
		{
			console.error("An error occured while trying to build: "+scriptName);
			console.error(e);
		}
	});
}

module.exports = {
	runBuildScript: runBuildScript,
	getBuildScripts: getBuildScripts
}
